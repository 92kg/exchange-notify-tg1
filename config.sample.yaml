# ============================================================
# 加密货币情绪监控系统 v3.0 配置文件
# ============================================================

# 交易所配置
exchange:
  name: "okx"  # 可选: okx, binance
  api_key: ""  # 如果需要认证功能（目前不需要）
  api_secret: ""
  api_passphrase: ""  # OKX需要

# 监控币种配置
coins:
  - symbol: "BTC"
    enabled: true
    weight: 0.6  # 共振分析权重
  
  - symbol: "ETH"
    enabled: true
    weight: 0.4
  
  # 山寨币示例（默认禁用）
  - symbol: "SOL"
    enabled: false
    weight: 0.3
  
  - symbol: "AVAX"
    enabled: false
    weight: 0.2
  
  - symbol: "MATIC"
    enabled: false
    weight: 0.2

# 信号阈值配置
thresholds:
  fear_buy: 25              # 恐慌买入阈值
  greed_sell: 75            # 贪婪卖出阈值（已禁用卖出信号）
  funding_panic_percentile: 15   # 资金费率恐慌分位数
  funding_greed_percentile: 85   # 资金费率贪婪分位数
  longshort_extreme: 0.8    # 多空比极端值

# Data Analysis Windows (Timeframes for historical data)
windows:
  reversal_history_hours: 72  # 拐点检测使用的历史窗口(小时)
  funding_history_hours: 168  # 资金费率分位数使用的历史窗口(小时)

# 策略开关（控制使用哪些条件）
# 详情请参考 STRATEGY_GUIDE.md
strategy:
  # 策略模式: "fear_buy" = 恐慌买入(回测胜率低), "trend" = 趋势跟随(推荐)
  mode: "trend"
  
  # 通用开关
  use_fear_greed: true      # 使用恐慌指数
  use_funding_percentile: true  # 使用资金费率分位数
  use_longshort: false       # 使用多空比（容易被操纵）
  use_reversal: true        # 使用拐点确认
  use_resonance: false       # 使用共振检测
  use_sell_signal: false    # 禁用卖出信号（回测表现差）

# 趋势策略配置 (mode: "trend")
trend_strategy:
  ma_short: 7               # 短期均线周期
  ma_long: 30               # 长期均线周期
  min_7d_change: 0          # 最小7天涨幅要求 (%)
  max_fg_value: 70          # 最高恐慌指数（避免追高）
  require_price_above_ma: true  # 价格必须高于均线
  # 评分系统配置（原硬编码值，现可调）
  score_threshold: 5        # 信号有效分数阈值
  high_momentum_7d: 10      # 强势涨幅阈值 (%)
  medium_momentum_7d: 5     # 中等涨幅阈值 (%)

# 自动交易配置
auto_close: false           # [新增] 是否触发止损时自动平仓 (生产环境建议开启前充分测试)

# 风控配置
risk:
  stop_loss_type: "trailing"  # fixed / trailing
  stop_loss_pct: -15          # 止损比例 (%)
  initial_stop: -20           # 初始止损（刚买入时使用）
  notify_on_stop: true        # 止损时发送通知

# 仓位管理 (Pyramiding)
position:
  pyramiding:
    enabled: true             # 是否允许盈利加仓
    min_profit_pct: 5.0       # 加仓门槛：持仓浮盈 > 5%
    max_count: 3              # 最大加仓次数

# 拐点确认配置
reversal:
  enabled: true
  consecutive_periods: 2    # 需要连续2次反转确认

# 共振配置
resonance:
  enabled: true
  min_coins: 2              # 至少几个币种共振

# Telegram配置
telegram:
  bot_token: "YOUR_BOT_TOKEN"
  chat_id: "YOUR_CHAT_ID"
  enabled: true

# 运行配置
runtime:
  check_interval: 300       # 检查间隔（秒）- 建议 300s (5分钟) 以便及时触发止损
  db_file: "crypto_sentiment_v3.db"
  log_file: "monitor.log"

# 回测配置
backtest:
  profit_days: [7, 14, 30]
  historical_days: 365
  # 手续费配置 (%)
  fee_rate: 0.1             # 单边手续费 (OKX现货约0.08%-0.1%)
  # 双向手续费 = fee_rate * 2 = 0.2% (买+卖)
  slippage: 0.1             # 滑点成本 (%) - 实际成交价与预期价差
  execution_delay: 0.5      # 执行延迟成本 (%) - 收到信号到下单的价格变动
  # 样本外验证 (防过拟合)
  train_test_split: 0.7     # 70%训练集, 30%测试集
  validate_out_of_sample: true  # 是否启用样本外验证